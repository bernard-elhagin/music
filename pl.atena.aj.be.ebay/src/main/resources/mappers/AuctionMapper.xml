<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
 
<mapper namespace="pl.atena.aj.be.ebay.mappers.AuctionDTO">
 
 	<resultMap type="AuctionDTO" id="AuctionDTOResult">
		<id property="auctionId" column="auc_auction_id" />
		<result property="name" column="auc_name" />
		<result property="description" column="auc_description" />
		<result property="endDate" column="auc_end_date" />
		<result property="finalPrice" column="auc_final_price" />
	</resultMap>

	<sql id="auctionDTOColumns">
		auc.auction_id   as auc_auction_id,
		auc.name         as auc_name,
		auc.description  as auc_description,
		auc.end_date     as auc_end_date,
		auc.final_price  as auc_final_price
	</sql>

	<sql id="auctionDTOFrom">
		FROM auction auc
	</sql>

	<select id="getAuctionDTO" parameterType="int" resultType="AuctionDTO" resultMap="AuctionDTOResult">
		SELECT
			<include refid="auctionDTOColumns" />
			<include refid="auctionDTOFrom" />
		WHERE auc.auction_id = #{id}
	</select>

	<select id="getAllAuctionDTO" resultMap="AuctionDTOResult">
		SELECT 
			<include refid="auctionDTOColumns" />
			<include refid="auctionDTOFrom" />
	</select>

	<insert id="createAuctionDTO" parameterType="AuctionDTO" useGeneratedKeys="true" keyProperty="auctionId">
		INSERT INTO
			auction(name,
			        description,
			        end_date,
			        final_price)
		VALUES(
				#{name},
				#{description},
				#{endDate},
				#{finalPrice})
	</insert>

	<update id="updateAuctionDTO" parameterType="AuctionDTO">
		UPDATE auction
		SET	name        = #{name},
		    description = #{description},
			end_date    = #{endDate},
			final_price = #{finalPrice}
		WHERE auction_id = #{auctionId}
	</update>

	<delete id="deleteAuctionDTO" parameterType="int">
		DELETE
			<include refid="auctionDTOFrom" />
		WHERE auction_id = #{id}
	</delete>
 
</mapper>